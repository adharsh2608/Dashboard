<div class="fixed top-4 right-4 z-50 flex items-center gap-2 select-none">
  <span class="text-xs text-gray-700 dark:text-gray-300">Light</span>
  <button type="button" role="switch" [attr.aria-checked]="isDark" (click)="toggleTheme()"
    class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"
    [ngClass]="isDark ? 'bg-blue-600' : 'bg-gray-300'">
    <span class="sr-only">Toggle theme</span>
    <span class="inline-block h-5 w-5 transform rounded-full bg-white transition"
          [ngClass]="isDark ? 'translate-x-5' : 'translate-x-1'"></span>
  </button>
  <span class="text-xs text-gray-700 dark:text-gray-300">Dark</span>
</div>

<div class="flex min-h-screen bg-white text-gray-800 dark:bg-gray-950 dark:text-gray-100">
  <aside class="w-64 bg-gray-50 border-r p-4 space-y-4 dark:bg-gray-900 dark:border-gray-800">
    <div class="flex items-center justify-between">
      <div class="font-bold text-lg mb-4">turboplanner</div>
    </div>

    <div class="mb-4">
      <div class="text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">🔍 Search Tasks</div>
      <div class="flex gap-2">
        <input #searchInput
          type="text" 
          [(ngModel)]="searchQuery"
          (input)="onSearch()"
          placeholder="Enter first letter..."
          class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"
        >
        <button 
          (click)="clearSearch()"
          class="px-3 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-md text-sm dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600"
        >
          ✕
        </button>
      </div>
    </div>

    <div class="space-x-2">
      <button class="px-3 py-1 rounded text-sm" [class.bg-blue-600]="selectedCategory==='All'" [class.text-white]="selectedCategory==='All'" (click)="setCategory('All')">All</button>
      <button class="px-3 py-1 rounded text-sm" [class.bg-blue-600]="selectedCategory==='Work'" [class.text-white]="selectedCategory==='Work'" (click)="setCategory('Work')">Work</button>
      <button class="px-3 py-1 rounded text-sm" [class.bg-blue-600]="selectedCategory==='Personal'" [class.text-white]="selectedCategory==='Personal'" (click)="setCategory('Personal')">Personal</button>
    </div>

    <nav class="space-y-2 text-sm mt-4">
      <a href="#" class="block p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-800" (click)="openAddTaskModal(); $event.preventDefault()">➕ Add Task</a>
    </nav>

    <div class="mt-6">
      <label class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400 mb-2 block">Sort by</label>
      <select [(ngModel)]="sortBy" (change)="setSort(sortBy)" class="w-full px-3 py-2 border rounded text-sm dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100">
        <option value="title">Title (A → Z)</option>
        <option value="category">Category</option>
        <option value="completed">Completion</option>
      </select>
    </div>
  </aside>

  <main class="flex-1 p-8 overflow-y-auto">
    <div class="text-2xl font-bold mb-4 flex items-end justify-between">
      <div>
        📋 Tasks
        <span *ngIf="searchQuery" class="text-lg font-normal text-gray-600 dark:text-gray-300 ml-2">
          (Filtered by "{{ searchQuery }}")
        </span>
      </div>
      <div class="w-64">
        <div class="text-xs mb-1 text-gray-600 dark:text-gray-300">Completed {{ progressPercent }}%</div>
        <div class="w-full h-2 rounded bg-gray-200 dark:bg-gray-800 overflow-hidden">
          <div class="h-full bg-green-500 transition-all" [style.width.%]="progressPercent"></div>
        </div>
      </div>
    </div>

    <div class="space-y-4" cdkDropList (cdkDropListDropped)="drop($event)">
      <div *ngFor="let task of filteredTasks; let i = index" cdkDrag
        class="p-4 rounded-lg shadow-md border flex items-center justify-between"
        [ngClass]="{
          'border-green-400 bg-green-50 dark:bg-green-900/30': task.completed,
          'border-orange-400 bg-orange-50 dark:bg-orange-900/30': !task.completed
        }">
        <div class="flex items-center gap-3">
          <input type="checkbox" [checked]="task.completed" (change)="toggleCompletion(task)" />
          <div>
            <div class="text-lg font-semibold">{{ task.title }}</div>
            <div class="text-xs text-gray-600 dark:text-gray-300">Category: {{ task.category }}</div>
          </div>
        </div>

        <div class="flex gap-2">
          <button class="text-sm px-3 py-1 bg-yellow-400 hover:bg-yellow-500 text-white rounded" (click)="onEditTask(i)">✏️ Edit</button>
          <button class="text-sm px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded" (click)="onDeleteTask(i)">🗑️</button>
        </div>
      </div>
      
      <div *ngIf="searchQuery && filteredTasks.length === 0" 
           class="text-center py-8 text-gray-500 dark:text-gray-300">
        <div class="text-lg mb-2">🔍 No tasks found</div>
        <div class="text-sm">No tasks start with the letter "{{ searchQuery }}"</div>
      </div>
    </div>
  </main>
</div>

<app-add-task-modal 
  *ngIf="showModal"
  [task]="editingTask"
  (close)="closeAddTaskModal()"
  (taskCreated)="addTaskToList($event)">
</app-add-task-modal>
